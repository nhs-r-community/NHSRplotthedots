<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Deviations from Excel defaults • NHSRplotthedots</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Deviations from Excel defaults">
<meta property="og:description" content="NHSRplotthedots">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">NHSRplotthedots</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/deviations.html">Deviations from Excel defaults</a>
    </li>
    <li>
      <a href="../articles/intro.html">Introduction to the `NHSRplotthedots` package</a>
    </li>
    <li>
      <a href="../articles/number-of-points-required.html">Number of points required</a>
    </li>
    <li>
      <a href="../articles/other-spc-tools.html">Other SPC tools</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nhs-r-community/NHSRplotthedots/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Deviations from Excel defaults</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nhs-r-community/NHSRplotthedots/blob/HEAD/vignettes/deviations.Rmd" class="external-link"><code>vignettes/deviations.Rmd</code></a></small>
      <div class="hidden name"><code>deviations.Rmd</code></div>

    </div>

    
    
<p>The overall intent of this package is to mimic as completely as
possible the output available from the <a href="https://www.england.nhs.uk/publication/making-data-count/" class="external-link">NHSEI
Making Data Count</a> Excel tools. However, we have identified some
areas where the R implementation should deviate from the main Excel
tools. We have done this only after careful consideration, and we
believe there is a benefit to deviating.</p>
<p>This vignette documents what these differences are, and how to set
options to over-ride them, so that if you need to you can completely
replicate the output that the Excel tools would create.</p>
<p>You may consider this important if for example you are publishing
outputs from both the Excel tool and this R tool, and need the outputs
to be completely consistent.</p>
<div class="section level2">
<h2 id="list-of-deviations">List of Deviations<a class="anchor" aria-label="anchor" href="#list-of-deviations"></a>
</h2>
<div class="section level3">
<h3 id="treatment-of-outlying-points">1. Treatment of outlying points<a class="anchor" aria-label="anchor" href="#treatment-of-outlying-points"></a>
</h3>
<p>By default, this package will screen outlying points, removing them
from the moving range calculation, and hence from the process limits
calculation. This is in line with the published paper:</p>
<blockquote>
<p>Nelson, LS, “Control Charts for Individual Measurements”, Journal of
Quality Technology, 1982, 14(34)</p>
</blockquote>
<p>It is discussed further in the book:</p>
<blockquote>
<p>Lloyd P Provost &amp; Sandra K Murray, The Health Care Data Guide:
Learning from Data for Improvement (San Francisco, CA: Jossey-Bass,
2011), p.155 &amp; p.192.</p>
</blockquote>
<p>The Making Data Count” Excel tools do not screen outlying points, and
all points are included in the moving range and limits calculations. If
outlying points exist, the process limits on the Excel tools will
therefore be wider than if outlying points were screened from the
calculation.</p>
<p>This behaviour is controlled by the <code>screen_outliers</code>
argument. By default, <code>screen_outliers = TRUE</code>.</p>
<p>To replicate the Excel method, set the argument
<code>screen_outliers = FALSE</code>.</p>
<p>The two charts below demonstrate the default, and how to over-ride to
replicate the Excel tools.</p>
<p><strong>R Package Default:</strong></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">10</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-03-22"</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">18</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">date</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># screen_outliers = TRUE by default</span></span>
<span><span class="va">spc_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ptd_spc.html">ptd_spc</a></span><span class="op">(</span><span class="va">df</span>, value_field <span class="op">=</span> <span class="va">data</span>, date_field <span class="op">=</span> <span class="va">date</span><span class="op">)</span></span>
<span><span class="va">spc_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>      <span class="st">"UPL = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">spc_data</span><span class="op">$</span><span class="va">upl</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>      <span class="st">", Mean = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">spc_data</span><span class="op">$</span><span class="va">mean_col</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>      <span class="st">", LPL = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">spc_data</span><span class="op">$</span><span class="va">lpl</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="deviations_files/figure-html/unnamed-chunk-1-1.png" width="672"></p>
<p><strong>Over-riding to replicate “Making Data Count” Excel
output:</strong></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># setting screen_outliers = FALSE produces the same output as Excel</span></span>
<span><span class="va">spc_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ptd_spc.html">ptd_spc</a></span><span class="op">(</span><span class="va">df</span>, value_field <span class="op">=</span> <span class="va">data</span>, date_field <span class="op">=</span> <span class="va">date</span>, screen_outliers <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">spc_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>      <span class="st">"UPL = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">spc_data</span><span class="op">$</span><span class="va">upl</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>      <span class="st">", Mean = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">spc_data</span><span class="op">$</span><span class="va">mean_col</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>      <span class="st">", LPL = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">spc_data</span><span class="op">$</span><span class="va">lpl</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="deviations_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="breaking-of-lines">2. Breaking of lines<a class="anchor" aria-label="anchor" href="#breaking-of-lines"></a>
</h3>
<p>By default, this package will break process and limit lines when a
plot is rebased. The Excel tool draws all lines as continuous lines.
However, rebasing is a change to the process, so by breaking lines it
more clearly indicates that a change in process has happened.</p>
<p>This can be controlled with the <code>break_lines</code> argument.
There are 4 possible values: * “both” (default) * “limit” (to just break
the limit lines, but leave the process line connected) * “process” (to
just break the process line, but leave limit lines connected) * “none”
(as per the Excel tool).</p>
<p>Examples of these 4 are shown below:</p>
<p><strong>R Package Default:</strong></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spc_data</span> <span class="op">&lt;-</span> <span class="va">ae_attendances</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">period</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="va">attendances</span>, <span class="va">sum</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/ptd_spc.html">ptd_spc</a></span><span class="op">(</span><span class="va">attendances</span>, <span class="va">period</span>, rebase <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2017-04-01"</span>, <span class="st">"2018-04-01"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in ptd_add_short_group_warnings(.): Some groups have 'n &lt; 12'</span></span>
<span><span class="co">#&gt; observations. These have trial limits, which will be revised with each</span></span>
<span><span class="co">#&gt; additional observation until 'n = fix_after_n_points' has been reached.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">spc_data</span>, break_lines <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span></span></code></pre></div>
<p><img src="deviations_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<p><strong>just breaking the limit lines:</strong></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">spc_data</span>, break_lines <span class="op">=</span> <span class="st">"limits"</span><span class="op">)</span></span></code></pre></div>
<p><img src="deviations_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<p><strong>just breaking the limit lines:</strong></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">spc_data</span>, break_lines <span class="op">=</span> <span class="st">"process"</span><span class="op">)</span></span></code></pre></div>
<p><img src="deviations_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<p><strong>Over-riding to replicate “Making Data Count” Excel
output:</strong></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">spc_data</span>, break_lines <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="deviations_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="x-axis-text-angle">3. X Axis Text Angle<a class="anchor" aria-label="anchor" href="#x-axis-text-angle"></a>
</h3>
<p>As can be seen in the plots above, by default this package will print
x axis text rotated by 45 degrees for better utilisation of space, and
readability. Excel’s behaviour is to print this text at 90 degrees to
the axis.</p>
<p>Text angle can be over-ridden by passing a ggplot
<code>theme()</code> into the <code>theme_override</code> argument of
the plot function. Any of the modifications documented in the <a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">ggplot2 theme
documentation</a> can be made, but in this case we just need to modify
<code>axis.text.x</code>.</p>
<p><strong>To re-instate 90 degree axis text:</strong></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ae_attendances</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">period</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="va">attendances</span>, <span class="va">sum</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/ptd_spc.html">ptd_spc</a></span><span class="op">(</span><span class="va">attendances</span>, <span class="va">period</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>    theme_override <span class="op">=</span> <span class="fu">theme</span><span class="op">(</span></span>
<span>      axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="deviations_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<hr>
<p>Find the package code on <a href="https://github.com/nhs-r-community/NHSRplotthedots" class="external-link">GitHub</a></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Christopher Reading, Simon Wellesley-Miller, Zoë Turner, Tom Jemmett, Tom Smith, Chris Mainey, John MacKintosh, Marcos Fabietti.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
