<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>SPC Plotting Function — ptd_spc • NHSRplotthedots</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="SPC Plotting Function — ptd_spc"><meta name="description" content="ptd_spc returns a plot object or data table with SPC values using NHSI
'plot the dots' logic."><meta property="og:description" content="ptd_spc returns a plot object or data table with SPC values using NHSI
'plot the dots' logic."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">NHSRplotthedots</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/NHSRplotthedots.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/number-of-points-required.html">Number of points required</a></li>
    <li><a class="dropdown-item" href="../articles/deviations.html">Deviations from Excel defaults</a></li>
    <li><a class="dropdown-item" href="../articles/other-spc-tools.html">Other SPC tools</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nhs-r-community/NHSRplotthedots/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>SPC Plotting Function</h1>
      <small class="dont-index">Source: <a href="https://github.com/nhs-r-community/NHSRplotthedots/blob/main/R/ptd_spc.R" class="external-link"><code>R/ptd_spc.R</code></a></small>
      <div class="d-none name"><code>ptd_spc.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>ptd_spc</code> returns a plot object or data table with SPC values using NHSI
'plot the dots' logic.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ptd_spc</span><span class="op">(</span></span>
<span>  <span class="va">.data</span>,</span>
<span>  <span class="va">value_field</span>,</span>
<span>  <span class="va">date_field</span>,</span>
<span>  <span class="va">facet_field</span>,</span>
<span>  rebase <span class="op">=</span> <span class="fu"><a href="ptd_rebase.html">ptd_rebase</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  fix_after_n_points <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  improvement_direction <span class="op">=</span> <span class="st">"increase"</span>,</span>
<span>  target <span class="op">=</span> <span class="fu"><a href="ptd_target.html">ptd_target</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">trajectory</span>,</span>
<span>  screen_outliers <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg--data">.data<a class="anchor" aria-label="anchor" href="#arg--data"></a></dt>
<dd><p>A data frame containing a value field, a date field,
and a category field (if for faceting). There should be no gaps in the time
series for each category.</p></dd>


<dt id="arg-value-field">value_field<a class="anchor" aria-label="anchor" href="#arg-value-field"></a></dt>
<dd><p>Specify the field name which contains the value data, to
be plotted on y axis. The field name can be specified using non-standard
evaluation (i.e. without quotation marks).</p></dd>


<dt id="arg-date-field">date_field<a class="anchor" aria-label="anchor" href="#arg-date-field"></a></dt>
<dd><p>Specify the field name which contains the date data, to be
plotted on x axis. The field name can be specified using non-standard
evaluation (i.e. without quotation marks).</p></dd>


<dt id="arg-facet-field">facet_field<a class="anchor" aria-label="anchor" href="#arg-facet-field"></a></dt>
<dd><p>Optional: Specify field name which contains a grouping/
faceting variable. SPC logic will be applied to each group separately, with
outputs combined. Currently accepts 1 variable only. The field name can be
specified using non-standard evaluation (i.e. without quotation marks).</p></dd>


<dt id="arg-rebase">rebase<a class="anchor" aria-label="anchor" href="#arg-rebase"></a></dt>
<dd><p>Specify a date vector of dates when to rebase, or, if
<code>facet_field</code> is set, a named list of date vectors of when to rebase. Each
item in the list should be named after the facet you wish to rebase. See
<code><a href="ptd_rebase.html">ptd_rebase()</a></code>.</p></dd>


<dt id="arg-fix-after-n-points">fix_after_n_points<a class="anchor" aria-label="anchor" href="#arg-fix-after-n-points"></a></dt>
<dd><p>Specify a number points after which to fix SPC
calculations.</p></dd>


<dt id="arg-improvement-direction">improvement_direction<a class="anchor" aria-label="anchor" href="#arg-improvement-direction"></a></dt>
<dd><p>Specify whether process improvement is
represented by an increase or decrease in measured variable, or is neutral.
Accepted values are 'increase' for increase as improvement, 'decrease' for
decrease as improvement, and 'neutral' where neither direction represents
an improvement. Defaults to 'increase'.</p></dd>


<dt id="arg-target">target<a class="anchor" aria-label="anchor" href="#arg-target"></a></dt>
<dd><p>Specify a single value, which will apply the same target to
every facet of an SPC chart, or named values of targets, where the names
correspond to the names of the facets, in order to have different targets
for each facet. See <code><a href="ptd_target.html">ptd_target()</a></code>.</p></dd>


<dt id="arg-trajectory">trajectory<a class="anchor" aria-label="anchor" href="#arg-trajectory"></a></dt>
<dd><p>Specify a field name which contains a trajectory value.
The field name can be specified using non-standard evaluation (i.e. without
quotation marks).</p></dd>


<dt id="arg-screen-outliers">screen_outliers<a class="anchor" aria-label="anchor" href="#arg-screen-outliers"></a></dt>
<dd><p>Whether to screen for outliers when calculating the
control limits. Defaults to <code>TRUE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of type <code>ptd_spc_df</code>. This is a data.frame which can be
further manipulated like any other data.frame. The default print() method
for <code>ptd_spc_df</code> is to call <code><a href="ptd_create_ggplot.html">ptd_create_ggplot()</a></code>, displaying the plot. If
you would like to get the data.frame, call as_tibble() or as.data.frame()
on the object.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function is designed to produce consistent SPC charts
across Information Department reporting, according to the 'plot the dots'
logic produced by NHSI. The function can return either a plot or data frame.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nhs-r-community/NHSRdatasets" class="external-link">NHSRdatasets</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘dplyr’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:stats’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     filter, lag</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:base’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     intersect, setdiff, setequal, union</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ae_attendances"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Pick a trust at random to look at their data for two years</span></span></span>
<span class="r-in"><span><span class="va">trust1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ae_attendances</span>, <span class="va">org_code</span> <span class="op">==</span> <span class="st">"RJZ"</span> <span class="op">&amp;</span> <span class="va">type</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Basic chart with improvement direction decreasing</span></span></span>
<span class="r-in"><span><span class="fu">ptd_spc</span><span class="op">(</span><span class="va">trust1</span>,</span></span>
<span class="r-in"><span>  value_field <span class="op">=</span> <span class="va">breaches</span>, date_field <span class="op">=</span> <span class="va">period</span>,</span></span>
<span class="r-in"><span>  improvement_direction <span class="op">=</span> <span class="st">"decrease"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ptd_spc-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Pick a few trust, and plot individually using facet</span></span></span>
<span class="r-in"><span><span class="co"># Also set the x-axis scale to vary for each and date groups to 3 months</span></span></span>
<span class="r-in"><span><span class="va">orgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RAS"</span>, <span class="st">"RJZ"</span>, <span class="st">"RR1"</span>, <span class="st">"RJC"</span>, <span class="st">"RQ1"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">trusts4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ae_attendances</span>, <span class="va">org_code</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">orgs</span>, <span class="va">type</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">ptd_spc</span><span class="op">(</span><span class="va">trusts4</span>,</span></span>
<span class="r-in"><span>  value_field <span class="op">=</span> <span class="va">breaches</span>, date_field <span class="op">=</span> <span class="va">period</span>, facet_field <span class="op">=</span> <span class="va">org_code</span>,</span></span>
<span class="r-in"><span>  improvement_direction <span class="op">=</span> <span class="st">"decrease"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s</span>, fixed_y_axis_multiple <span class="op">=</span> <span class="cn">FALSE</span>, x_axis_breaks <span class="op">=</span> <span class="st">"3 months"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ptd_spc-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Save the first chart as an object this time then alter the ggplot theme</span></span></span>
<span class="r-in"><span><span class="va">my_spc</span> <span class="op">&lt;-</span> <span class="fu">ptd_spc</span><span class="op">(</span><span class="va">trust1</span>,</span></span>
<span class="r-in"><span>  value_field <span class="op">=</span> <span class="st">"breaches"</span>, date_field <span class="op">=</span> <span class="st">"period"</span>,</span></span>
<span class="r-in"><span>  improvement_direction <span class="op">=</span> <span class="st">"decrease"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_spc</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ptd_spc-3.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christopher Reading, Simon Wellesley-Miller, Zoë Turner, Tom Jemmett, Tom Smith, Chris Mainey, John MacKintosh, Marcos Fabietti, Fran Barton.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

