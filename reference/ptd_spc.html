<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>SPC Plotting Function — ptd_spc • NHSRplotthedots</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="SPC Plotting Function — ptd_spc"><meta property="og:description" content="ptd_spc returns a plot object or data table with SPC values using NHSI
'plot the dots' logic."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">NHSRplotthedots</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/deviations.html">Deviations from Excel defaults</a>
    </li>
    <li>
      <a href="../articles/intro.html">Introduction to the `NHSRplotthedots` package</a>
    </li>
    <li>
      <a href="../articles/number-of-points-required.html">Number of points required</a>
    </li>
    <li>
      <a href="../articles/other-spc-tools.html">Other SPC tools</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/nhs-r-community/NHSRplotthedots/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>SPC Plotting Function</h1>
    <small class="dont-index">Source: <a href="https://github.com/nhs-r-community/NHSRplotthedots/blob/HEAD/R/ptd_spc.R" class="external-link"><code>R/ptd_spc.R</code></a></small>
    <div class="hidden name"><code>ptd_spc.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>ptd_spc</code> returns a plot object or data table with SPC values using NHSI
'plot the dots' logic.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ptd_spc</span><span class="op">(</span></span>
<span>  <span class="va">.data</span>,</span>
<span>  <span class="va">value_field</span>,</span>
<span>  <span class="va">date_field</span>,</span>
<span>  <span class="va">facet_field</span>,</span>
<span>  rebase <span class="op">=</span> <span class="fu"><a href="ptd_rebase.html">ptd_rebase</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  fix_after_n_points <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  improvement_direction <span class="op">=</span> <span class="st">"increase"</span>,</span>
<span>  target <span class="op">=</span> <span class="fu"><a href="ptd_target.html">ptd_target</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">trajectory</span>,</span>
<span>  screen_outliers <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>.data</dt>
<dd><p>A data frame containing a value field, a date field,
and a category field (if for faceting). There should be no gaps in the time
series for each category.</p></dd>


<dt>value_field</dt>
<dd><p>Specify the field name which contains the value data, to
be plotted on y axis. The field name can be specified using non-standard
evaluation (i.e. without quotation marks).</p></dd>


<dt>date_field</dt>
<dd><p>Specify the field name which contains the date data, to be
plotted on x axis. The field name can be specified using non-standard
evaluation (i.e. without quotation marks).</p></dd>


<dt>facet_field</dt>
<dd><p>Optional: Specify field name which contains a grouping/
faceting variable. SPC logic will be applied to each group separately, with
outputs combined. Currently accepts 1 variable only. The field name can be
specified using non-standard evaluation (i.e. without quotation marks).</p></dd>


<dt>rebase</dt>
<dd><p>Specify a date vector of dates when to rebase, or, if
<code>facet_field</code> is set, a named list of date vectors of when to rebase. Each
item in the list should be named after the facet you wish to rebase. See
<code><a href="ptd_rebase.html">ptd_rebase()</a></code>.</p></dd>


<dt>fix_after_n_points</dt>
<dd><p>Specify a number points after which to fix SPC
calculations.</p></dd>


<dt>improvement_direction</dt>
<dd><p>Specify whether process improvement is
represented by an increase or decrease in measured variable, or is neutral.
Accepted values are 'increase' for increase as improvement, 'decrease' for
decrease as improvement, and 'neutral' where neither direction represents
an improvement. Defaults to 'increase'.</p></dd>


<dt>target</dt>
<dd><p>Specify a single value, which will apply the same target to
every facet of an SPC chart, or named values of targets, where the names
correspond to the names of the facets, in order to have different targets
for each facet. See <code><a href="ptd_target.html">ptd_target()</a></code>.</p></dd>


<dt>trajectory</dt>
<dd><p>Specify a field name which contains a trajectory value.
The field name can be specified using non-standard evaluation (i.e. without
quotation marks).</p></dd>


<dt>screen_outliers</dt>
<dd><p>Whether to screen for outliers when calculating the
control limits. Defaults to <code>TRUE</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>An object of type <code>ptd_spc_df</code>. This is a data.frame which can be
further manipulated like any other data.frame. The default print() method
for <code>ptd_spc_df</code> is to call <code><a href="ptd_create_ggplot.html">ptd_create_ggplot()</a></code>, displaying the plot. If
you would like to get the data.frame, call as_tibble() or as.data.frame()
on the object.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This function is designed to produce consistent SPC charts
across Information Department reporting, according to the 'plot the dots'
logic produced by NHSI. The function can return either a plot or data frame.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nhs-r-community/NHSRdatasets" class="external-link">NHSRdatasets</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘dplyr’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:stats’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     filter, lag</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:base’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     intersect, setdiff, setequal, union</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ae_attendances"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Pick a trust at random to look at their data for two years</span></span></span>
<span class="r-in"><span><span class="va">trust1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ae_attendances</span>, <span class="va">org_code</span> <span class="op">==</span> <span class="st">"RJZ"</span> <span class="op">&amp;</span> <span class="va">type</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Basic chart with improvement direction decreasing</span></span></span>
<span class="r-in"><span><span class="fu">ptd_spc</span><span class="op">(</span><span class="va">trust1</span>,</span></span>
<span class="r-in"><span>  value_field <span class="op">=</span> <span class="va">breaches</span>, date_field <span class="op">=</span> <span class="va">period</span>,</span></span>
<span class="r-in"><span>  improvement_direction <span class="op">=</span> <span class="st">"decrease"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ptd_spc-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Pick a few trust, and plot individually using facet</span></span></span>
<span class="r-in"><span><span class="co"># Also set the x-axis scale to vary for each and date groups to 3 months</span></span></span>
<span class="r-in"><span><span class="va">orgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RAS"</span>, <span class="st">"RJZ"</span>, <span class="st">"RR1"</span>, <span class="st">"RJC"</span>, <span class="st">"RQ1"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">trusts4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ae_attendances</span>, <span class="va">org_code</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">orgs</span>, <span class="va">type</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">ptd_spc</span><span class="op">(</span><span class="va">trusts4</span>,</span></span>
<span class="r-in"><span>  value_field <span class="op">=</span> <span class="va">breaches</span>, date_field <span class="op">=</span> <span class="va">period</span>, facet_field <span class="op">=</span> <span class="va">org_code</span>,</span></span>
<span class="r-in"><span>  improvement_direction <span class="op">=</span> <span class="st">"decrease"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s</span>, fixed_y_axis_multiple <span class="op">=</span> <span class="cn">FALSE</span>, x_axis_breaks <span class="op">=</span> <span class="st">"3 months"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ptd_spc-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Save the first chart as an object this time then alter the ggplot theme</span></span></span>
<span class="r-in"><span><span class="va">my_spc</span> <span class="op">&lt;-</span> <span class="fu">ptd_spc</span><span class="op">(</span><span class="va">trust1</span>,</span></span>
<span class="r-in"><span>  value_field <span class="op">=</span> <span class="st">"breaches"</span>, date_field <span class="op">=</span> <span class="st">"period"</span>,</span></span>
<span class="r-in"><span>  improvement_direction <span class="op">=</span> <span class="st">"decrease"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_spc</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ptd_spc-3.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Christopher Reading, Simon Wellesley-Miller, Zoë Turner, Tom Jemmett, Tom Smith, Chris Mainey, John MacKintosh, Marcos Fabietti.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

